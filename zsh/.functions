########################### COLOR SCRIPT #########################################
color() {                          # Define a function named "color"
    if [[ $# -eq 0 ]]; then       # If NO arguments passed (you just type "color")
        echo "ðŸ“¦ Available colorscript patterns:\n"
        colorscript -l             # Show list of all patterns
        echo "\nðŸ’¡ Usage:"         # Print helpful usage instructions
        echo "  color <pattern>..."
        
    elif [[ "$1" == "list" ]]; then   # If you type "color list"
        colorscript -l                 # Just show the list
        
    elif [[ "$1" == "random" ]]; then # If you type "color random"
        colorscript -r                 # Show a random pattern
        
    else                               # Otherwise (you typed "color square")
        colorscript -e "$1"            # Run colorscript with your pattern name
    fi
}

########################### BATTERY INFORMATION ################################
mybatinfo() {
    ioreg -rn AppleSmartBattery | awk -F'= ' '
    /"CurrentCapacity"/ {curcap=$2}
    /"MaxCapacity"/ {maxcap=$2}
    /"AppleRawMaxCapacity"/ {rawmax=$2}
    /"DesignCapacity"/ {designcap=$2}
    /"CycleCount"/ {cycle=$2}
    /"Voltage"/ {volt=sprintf("%.2f", $2/1000)}
    /"ExternalConnected"/ {plug=$2}
    /"IsCharging"/ {charging=$2}
    /"FullyCharged"/ {full=$2}
    END {
        true_charge = (maxcap > 0) ? (curcap / maxcap) * 100 : 0
        health = (designcap > 0) ? (rawmax / designcap) * 100 : 0
        current_design_mah = (designcap > 0 && maxcap > 0) ? sprintf("%.0f", curcap * (designcap / maxcap)) : curcap

        print "ðŸ”‹ Battery Report"
        print "------------------------------"
        printf "True Charge       : %.1f%% (raw)\n", true_charge
        printf "macOS Display %%   : %.1f%%\n", true_charge
        printf "Health (Max Cap)  : %.1f%%\n", health
        printf "Current Capacity  : %d mAh (of %d mAh, %.1f%%)\n", current_design_mah, designcap, true_charge
        printf "Full Capacity     : %d mAh\n", rawmax
        printf "Design (Native)   : %d mAh\n", designcap
        printf "Cycle Count       : %s\n", cycle
        printf "Voltage           : %s V\n", volt
        power = (plug == "Yes") ? "AC" : "Battery"
        printf "Power Source      : %s\n", power
        if (charging == "Yes") {
            charge_status = "Charging"
        } else if (plug == "Yes" && full == "Yes") {
            charge_status = "Bypass (100%)"
        } else {
            charge_status = "Not Charging"
        }
        printf "Charging          : %s\n", charge_status
    }'
}
 
############################### Clean Branch history #######################################
clean_branch() {
  local branch="${1:-main}"
  local orphan_branch="clean-$branch"

  # Ensure everything is committed.
  git status
  echo "Check: Ensure all work committed and remote is up to date."

  # Create orphan branch with *no* history
  git checkout --orphan "$orphan_branch"
  
  # Remove all tracked files from index
  git rm -rf .            # removes from git index, not disk

  # Add and commit up-to-date files
  git add .
  git commit -m "chore: fresh start with up-to-date files"

  # Delete old branch
  git branch -D "$branch"
  
  # Rename orphan branch to original name
  git branch -m "$branch"
  
  # Force-push to remote (overwrites history!)
  git push --force origin "$branch"

  # Link local branch to remote (upstream)
  git branch --set-upstream-to="origin/$branch" "$branch"

  echo "Done! Branch '$branch' is a clean slate and now tracks origin/$branch."
}

###################################### Spicetify Quick Apply ######################################
spice() {
    local theme_name="$1"
    local color_scheme="$2"

    if [ -z "$theme_name" ]; then
        echo "Usage: spice <theme_name> [color_scheme]"
        return 1
    fi

    local theme_dir="$HOME/.config/spicetify/Themes/$theme_name"

    # Check if theme exists
    if [ ! -d "$theme_dir" ]; then
        echo "Theme '$theme_name' not found. Available themes:"
        ls "$HOME/.config/spicetify/Themes"
        return 1
    fi

    # Set theme
    spicetify config current_theme "$theme_name"

    # Handle color scheme
    if [ -n "$color_scheme" ]; then
        if ! grep -q "\[$color_scheme\]" "$theme_dir/color.ini"; then
            echo "Color scheme '$color_scheme' not found. Available schemes:"
            grep "^\[" "$theme_dir/color.ini" | tr -d "[]"
            return 1   # prevent apply if invalid
        fi
        spicetify config color_scheme "$color_scheme"
    fi

    # Apply theme 
    spicetify apply >/dev/null 2>&1

    echo "Theme '$theme_name' applied${color_scheme:+ with color scheme '$color_scheme'}."
}

#######################################################################################################